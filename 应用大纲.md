# 智能抄表应用 - 应用大纲

## 📱 应用概述

**应用名称**: 智能抄表  
**技术栈**: Flutter + Dart  
**主要功能**: 燃气表、水表、电表智能识别与管理系统  
**目标用户**: 物业管理人员、房屋管理者  

## 🏗️ 应用架构

### 📁 项目结构
```
lib/
├── main.dart                    # 应用入口
├── models/                      # 数据模型层
├── services/                    # 业务服务层
├── screens/                     # 界面展示层
└── theme/                       # 主题样式层
```

## 🎯 核心功能模块

### 1. 🏠 首页模块 (HomeScreen)
- **拍照识别**: 调用相机拍摄表计照片
- **相册选择**: 从相册选择表计图片
- **智能识别**: 调用阿里云API识别表计读数
- **结果编辑**: 支持手动修正识别结果
- **数据保存**: 保存识别记录到本地
- **表计类型**: 支持燃气表、水表、电表识别

### 2. 🏢 楼层管理模块 (FloorManagementScreen)
- **楼层管理**: 添加、删除、查看楼层信息
- **房间管理**: 管理各楼层的房间信息
- **房间详情**: 设置房间号、水电燃气单价、入住信息
- **智能添加**: 自动计算下一个楼层号
- **拍照识别**: 直接在房间卡片中进行表计识别
- **数据同步**: 实时更新房间和楼层数据

### 3. 📊 管理中心模块 (ManagementScreen)
- **租金管理**: 房间租金信息管理
- **单价管理**: 水电燃气单价设置
- **服务费管理**: 公共服务费和卫生费管理
- **月度报表**: 费用报表查看和导出
- **导出配置**: 公司信息和银行账号设置

### 4. 👤 个人中心模块 (MyScreen)
- **用户信息**: 显示用户基本信息
- **统计数据**: 识别记录统计、房间数量统计
- **功能导航**: 快速访问各功能模块
- **系统设置**: 应用设置和数据管理
- **关于我们**: 应用信息和帮助

### 5. 📝 记录管理模块
- **识别记录** (AllRecordsScreen): 查看所有识别记录
- **表记录详情** (MeterRecordsScreen): 详细的表计识别记录
- **房间详情** (RoomDetailScreen): 单个房间的详细信息

### 6. 💰 费用管理模块
- **租金管理** (RentManagementScreen): 房间租金设置和管理
- **单价管理** (UnitPriceManagementScreen): 水电燃气单价管理
- **服务费管理** (ServiceFeeManagementScreen): 各类服务费用管理
- **月度报表** (MonthlyReportScreen): 月度费用统计报表

### 7. 📤 导出配置模块
- **导出配置** (ExportConfigScreen): 报表导出的公司信息配置
- **HTML预览** (HtmlPreviewScreen): 报表HTML格式预览
- **图片预览** (ImagePreviewScreen): 图片查看和处理

### 8. 🔐 用户认证模块
- **登录页面** (LoginScreen): 用户登录验证

## 🗃️ 数据模型

### 核心数据模型

#### 1. Room (房间模型)
```dart
class Room {
  String id;                    // 房间唯一标识
  int floor;                    // 楼层号
  String roomNumber;            // 房间号
  double waterPricePerTon;      // 水费单价
  double electricityPricePerKwh; // 电费单价
  double gasPricePerCubicMeter; // 燃气费单价
  double initialWaterAmount;    // 初始水量
  double initialElectricityAmount; // 初始电量
  double initialGasAmount;      // 初始燃气量
  String? occupantName;         // 入住人姓名
  String? contactPhone;         // 联系电话
  String? wechatId;            // 微信号
  DateTime? checkInDate;        // 入住日期
  String? checkInInfo;         // 入住信息
  double? monthlyRent;         // 月租金
  double? serviceFee;          // 服务费
  double? cleaningFee;         // 卫生费
}
```

#### 2. MeterRecord (表记录模型)
```dart
class MeterRecord {
  String id;                    // 记录唯一标识
  String imagePath;             // 图片路径
  String base64Image;           // Base64编码图片
  String recognitionResult;     // 识别结果
  int floor;                    // 楼层号
  String roomNumber;            // 房间号
  DateTime timestamp;           // 识别时间
  String meterType;             // 表计类型（燃气/水/电）
  String? requestId;            // API请求ID
  String? integerPart;          // 整数部分
  String? decimalPart;          // 小数部分
  List<RecognitionDetail>? recognitionDetails; // 识别详情
  bool isManuallyEdited;        // 是否手动修正
}
```

#### 3. Floor (楼层模型)
```dart
class Floor {
  int floorNumber;              // 楼层号
  DateTime createdAt;           // 创建时间
  String description;           // 楼层描述
}
```

#### 4. 其他模型
- **RentRecord**: 租金记录模型
- **UnitPrice**: 单价配置模型
- **ServiceFee**: 服务费模型
- **RentConfig**: 租金配置模型
- **ExportConfig**: 导出配置模型

## 🔧 服务层架构

### 1. StorageService (存储服务)
- 本地数据存储管理
- SharedPreferences数据持久化
- 房间、楼层、记录的CRUD操作
- 数据迁移和版本管理

### 2. RecognitionService (识别服务)
- 阿里云表计识别API集成
- 图片Base64编码处理
- 识别结果解析和格式化
- 错误处理和重试机制

### 3. EventManager (事件管理)
- 应用内事件通信
- 数据更新通知
- 页面间状态同步

### 4. ExportService (导出服务)
- 报表数据导出
- HTML格式生成
- 文件分享功能

### 5. FeeCalculationService (费用计算服务)
- 水电燃气费用计算
- 租金和服务费统计
- 月度报表生成

### 6. MigrationService (迁移服务)
- 数据版本升级
- 历史数据兼容性处理

## 🎨 UI/UX 设计

### 设计风格
- **Material Design**: 遵循Google Material Design规范
- **现代简洁**: 清爽的界面设计，注重用户体验
- **渐变效果**: 使用渐变色彩增强视觉效果
- **卡片布局**: 采用卡片式布局，信息层次清晰

### 主题配置 (AppTheme)
- **主色调**: 蓝色系 (#1976D2)
- **辅助色**: 成功绿色、警告橙色、错误红色
- **字体大小**: 12px-24px 分级字体系统
- **圆角设计**: 8px-24px 多级圆角
- **阴影效果**: 统一的卡片阴影样式

### 响应式设计
- 支持不同屏幕尺寸适配
- 横竖屏切换支持
- 触摸友好的交互设计

## 🔌 第三方集成

### API服务
- **阿里云表计识别API**: 燃气表智能识别
- **HTTP请求**: 网络通信处理

### 功能插件
- **image_picker**: 相机和相册图片选择
- **shared_preferences**: 本地数据存储
- **path_provider**: 文件路径管理
- **share_plus**: 文件分享功能
- **webview_flutter**: 网页内容展示
- **screenshot**: 截图功能
- **gal**: 图片保存到相册
- **uuid**: 唯一标识符生成
- **intl**: 国际化和日期格式化

## 📱 应用权限

### Android权限
- **相机权限**: 拍摄表计照片
- **存储权限**: 保存图片和数据
- **网络权限**: API调用和数据同步

### iOS权限
- **相机使用权限**: 访问设备相机
- **照片库权限**: 访问相册选择图片
- **网络访问权限**: 网络数据传输

## 🚀 核心特性

### 1. 智能识别
- 高精度表计读数识别
- 支持多种表计类型
- 识别结果可手动修正
- 识别历史记录管理

### 2. 数据管理
- 楼层房间层级管理
- 完整的房间信息配置
- 租金和费用管理
- 数据导出和分享

### 3. 用户体验
- 直观的操作界面
- 智能输入提示
- 实时数据同步
- 离线数据支持

### 4. 报表功能
- 月度费用统计
- 多格式报表导出
- 可视化数据展示
- 自定义导出配置

## 📈 技术优势

1. **跨平台**: Flutter框架支持iOS和Android双平台
2. **高性能**: 原生性能的用户体验
3. **模块化**: 清晰的代码架构，易于维护和扩展
4. **数据安全**: 本地存储，数据隐私保护
5. **智能化**: AI识别技术，提高工作效率
6. **可扩展**: 插件化架构，功能易于扩展

## 🔄 数据流程

### 识别流程
1. 用户拍摄或选择表计图片
2. 图片转换为Base64编码
3. 调用阿里云识别API
4. 解析识别结果并展示
5. 用户确认或修正结果
6. 保存记录到本地存储

### 管理流程
1. 创建楼层和房间结构
2. 配置房间基本信息
3. 设置水电燃气单价
4. 进行表计识别记录
5. 生成费用统计报表
6. 导出和分享数据

## 🎯 应用价值

- **提高效率**: 自动化表计读数，减少人工抄表时间
- **减少错误**: AI识别降低人为读数错误
- **数据管理**: 系统化管理房屋和费用信息
- **成本控制**: 精确的费用计算和统计
- **便民服务**: 简化物业管理流程，提升服务质量

---

*本文档基于应用当前版本 v1.0.0 编写，随着功能迭代可能会有更新。*